<div class="container-fluid py-3">
    <!-- Header Section -->
    <div class="row align-items-center mb-3">
        <div class="col-md-4">
            <h1>Attendance Details</h1>
        </div>
        <div class="position-absolute top-0 end-0 m-3">
            <button mat-raised-button color="primary" class="d-flex align-items-center" (click)="refreshComponent()">
                <mat-icon class="me-2">refresh</mat-icon>
                Last synced: {{ lastSyncedTime }}
            </button>
        </div>

    </div>

    <!-- Filters Section -->
    <!-- Filters Section -->
    <div class="filters-container mb-4 p-3 rounded shadow-sm">
        <div class="row g-3">
            <!-- Tenant Filter -->
            <div class="col-lg-3 col-md-6">
                <mat-form-field appearance="outline" class="w-100 filter-field">
                    <mat-label>Select Tenant</mat-label>
                    <mat-select [(value)]="selectedCompany" (selectionChange)="filterTable()">
                        <mat-option value="">All</mat-option>
                        <mat-option value="UBM">UBM</mat-option>
                        <mat-option value="Wateen">Wateen</mat-option>
                    </mat-select>
                </mat-form-field>
            </div>

            <!-- Category Filter -->
            <div class="col-lg-3 col-md-6">
                <mat-form-field appearance="outline" class="w-100 filter-field">
                    <mat-label>Select Category</mat-label>
                    <mat-select [(value)]="selectedCategory" (selectionChange)="filterTable()">
                        <mat-option value="">All</mat-option>
                        <mat-option value="tenant">Tenant</mat-option>
                        <mat-option value="employee">Employee</mat-option>
                        <mat-option value="visitor">Visitor</mat-option>
                    </mat-select>
                </mat-form-field>
            </div>

            <!-- Search Filter -->
            <div class="col-lg-4 col-md-6">
                <mat-form-field appearance="outline" class="w-100 filter-field">
                    <mat-label>Search</mat-label>
                    <input matInput [(ngModel)]="searchQuery" (ngModelChange)="filterTable()"
                        placeholder="Type to search..." />
                </mat-form-field>
            </div>

            <!-- Checkbox -->
            <div class="col-lg-2 col-md-6 d-flex align-items-center">
                <mat-checkbox [(ngModel)]="isPresent" (change)="filterTable()">Present</mat-checkbox>
            </div>
        </div>
    </div>
    <div class="row">
        <div class="col-lg-6 mb-4">
            <mat-card class="check-in-card mat-elevation-z4">
                <mat-card-header>
                    <mat-card-title class="fw-bold">Check-In Logs</mat-card-title>
                    <mat-card-subtitle class="text-muted">Latest attendance records</mat-card-subtitle>
                </mat-card-header>
    
                <mat-card-content>
                    <div class="table-responsive">
                        <mat-table [dataSource]="dataSource" class="custom-table w-100">
    
                            <ng-container matColumnDef="id">
                                <mat-header-cell *matHeaderCellDef> Id </mat-header-cell>
                                <mat-cell *matCellDef="let record"> {{ record.id }} </mat-cell>
                            </ng-container>
    
                            <ng-container matColumnDef="name">
                                <mat-header-cell *matHeaderCellDef> Name </mat-header-cell>
                                <mat-cell *matCellDef="let record"> {{ record.name }} </mat-cell>
                            </ng-container>
    
                            <ng-container matColumnDef="company">
                                <mat-header-cell *matHeaderCellDef> Company </mat-header-cell>
                                <mat-cell *matCellDef="let record"> {{ record.company }} </mat-cell>
                            </ng-container>
    
                            <ng-container matColumnDef="category">
                                <mat-header-cell *matHeaderCellDef> Category </mat-header-cell>
                                <mat-cell *matCellDef="let record"> {{ record.category }} </mat-cell>
                            </ng-container>
    
                            <ng-container matColumnDef="phone">
                                <mat-header-cell *matHeaderCellDef> Contact # </mat-header-cell>
                                <mat-cell *matCellDef="let record"> {{ record.phone }} </mat-cell>
                            </ng-container>
    
                            <mat-header-row *matHeaderRowDef="displayedColumns"></mat-header-row>
                            <mat-row *matRowDef="let row; columns: displayedColumns;" (click)="onRowClick(row)"
                                class="clickable-row">
                            </mat-row>
                        </mat-table>
                    </div>
                </mat-card-content>
    
                <mat-card-actions align="end">
                    <!-- âœ… Angular Material Paginator inside card footer -->
                    <mat-paginator [pageSizeOptions]="[5, 10, 20]" showFirstLastButtons></mat-paginator>
                </mat-card-actions>
            </mat-card>
              <div style="padding-top:20px;">
            <!-- Attendance Section -->
            <section *ngIf="checkinVisible" class="log-card card shadow-sm border-0">
                <div
                    class="card-header d-flex justify-content-between align-items-center bg-white border-0 logs-header">
                    <h1>Attendance Details</h1>
                    <div class="action-buttons">
                        <button class="btn btn-outline-success btn-sm me-2" (click)="refreshLogs()"
                            matTooltip="Refresh">
                            <i class="fa fa-refresh me-1"></i> Refresh
                        </button>
                        <button class="btn btn-primary btn-sm" (click)="hidecheckin()">
                            See AI Detection Logs
                        </button>
                    </div>
                </div>

                <div class="card-body p-0">
                    <div class="table-responsive">
                        <mat-table [dataSource]="attendanceDataSource" class="mat-elevation-z8 w-100">
                            <!-- Date -->
                            <ng-container matColumnDef="date">
                                <mat-header-cell *matHeaderCellDef>Date</mat-header-cell>
                                <mat-cell *matCellDef="let log">{{ log.date | date:'yyyy-MM-dd' }}</mat-cell>
                            </ng-container>

                            <!-- Check-In Time -->
                            <ng-container matColumnDef="checkInTime">
                                <mat-header-cell *matHeaderCellDef>Check-In Time</mat-header-cell>
                                <mat-cell *matCellDef="let log">{{ log.checkInTime }}</mat-cell>
                            </ng-container>

                            <!-- Check-Out Time -->
                            <ng-container matColumnDef="checkOutTime">
                                <mat-header-cell *matHeaderCellDef>Check-Out Time</mat-header-cell>
                                <mat-cell *matCellDef="let log">{{ log.checkOutTime }}</mat-cell>
                            </ng-container>

                            <mat-header-row *matHeaderRowDef="logColumns"></mat-header-row>
                            <mat-row *matRowDef="let log; columns: logColumns;"></mat-row>
                        </mat-table>
                    </div>
                </div>

                <div class="card-footer bg-white border-0">
                    <mat-paginator #attendancePaginator [pageSize]="5" [pageSizeOptions]="[5, 10, 20]"
                        showFirstLastButtons>
                    </mat-paginator>
                </div>
            </section>

            <!-- AI Detection Section -->
            <section *ngIf="!checkinVisible" class="log-card card shadow-sm border-0">
                <div
                    class="card-header d-flex justify-content-between align-items-center bg-white border-0 logs-header">
                    <h2 class="h5 m-0 fw-bold text-primary">AI Detection Logs</h2>
                    <div class="action-buttons">
                        <button class="btn btn-outline-success btn-sm me-2" (click)="refreshLogs()"
                            matTooltip="Refresh Logs">
                            <i class="fa fa-refresh me-1"></i> Refresh
                        </button>
                        <button class="btn btn-primary btn-sm" (click)="hideTimeStamp()">
                            See Attendance Details
                        </button>
                    </div>
                </div>

                <div class="card-body p-0">
                    <div class="table-responsive">
                        <mat-table [dataSource]="aiLogsDataSource" class="mat-elevation-z8 w-100">
                            <!-- ID -->
                            <ng-container matColumnDef="id">
                                <mat-header-cell *matHeaderCellDef>Id</mat-header-cell>
                                <mat-cell *matCellDef="let log">{{ log.employeeId }}</mat-cell>
                            </ng-container>

                            <!-- Date -->
                            <ng-container matColumnDef="date">
                                <mat-header-cell *matHeaderCellDef>Date</mat-header-cell>
                                <mat-cell *matCellDef="let log">{{ log.date | date:'yyyy-MM-dd' }}</mat-cell>
                            </ng-container>

                            <!-- Day -->
                            <ng-container matColumnDef="day">
                                <mat-header-cell *matHeaderCellDef>Day</mat-header-cell>
                                <mat-cell *matCellDef="let log">{{ log.day }}</mat-cell>
                            </ng-container>

                            <!-- Timestamp -->
                            <ng-container matColumnDef="TimeStamp">
                                <mat-header-cell *matHeaderCellDef>TimeStamp</mat-header-cell>
                                <mat-cell *matCellDef="let log">{{ log.timestamp }}</mat-cell>
                            </ng-container>

                            <mat-header-row *matHeaderRowDef="TimeStamplogColumns"></mat-header-row>
                            <mat-row *matRowDef="let log; columns: TimeStamplogColumns;"></mat-row>
                        </mat-table>
                    </div>
                </div>

                <div class="card-footer bg-white border-0">
                    <mat-paginator #aiLogsPaginator [pageSize]="5" [pageSizeOptions]="[5, 10, 20]" showFirstLastButtons>
                    </mat-paginator>
                </div>
            </section>
        </div>
        </div>
        <div class="col-lg-6 mb-4" *ngIf="selectedEmployee">
            <mat-card class="employee-info-card shadow-sm">
                <!-- Custom Header inside Card Content -->
                <mat-card-content>
                    <div class="d-flex align-items-center employee-header">
                        <!-- Left Side: Photo -->
                        <div class="employee-photo me-3">
                            <img [src]="'data:image/jpeg;base64,' + imagePath1Base64" alt="Employee Photo" />
                        </div>
    
                        <!-- Right Side: Info -->
                        <div class="employee-info">
                            <h2 class="mb-1">{{ selectedEmployee.name }}</h2>
                            <small class="text-muted">Employee ID: {{ selectedEmployee.id }}</small>
                        </div>
                    </div>
                    <!-- Employee Details -->
                    <div class="row g-3">
                        <div class="col-md-6">
                            <p><strong>CNIC:</strong> {{ selectedEmployee.cnic }}</p>
                            <p><strong>Phone:</strong> {{ selectedEmployee.phone }}</p>
                            <p><strong>Email:</strong> {{ selectedEmployee.email }}</p>
                        </div>
    
                        <div class="col-md-6">
                            <p><strong>Address:</strong> {{ selectedEmployee.address }}</p>
                            <p><strong>Company:</strong> {{ selectedEmployee.company }}</p>
                        </div>
    
                        <!-- Access Status -->
                        <div class="col-12 mt-2">
                            <strong>Access Status:</strong>
                            <mat-chip
                                [ngClass]="{ 'bg-success text-white': accessStatus === 'Allowed', 'bg-danger text-white': accessStatus === 'Revoked' }">
                                {{ accessStatus }}
                            </mat-chip>
    
                            <button *ngIf="accessStatus === 'Revoked'" mat-raised-button color="primary" class="ms-3"
                                (click)="allowAccess()">
                                Allow Access
                            </button>
                            <button *ngIf="accessStatus === 'Allowed'" mat-raised-button color="warn" class="ms-3"
                                (click)="revokeAccess()">
                                Revoke Access
                            </button>
                        </div>
                    </div>
                </mat-card-content>
                 <div>
            <div class="d-flex justify-content-end align-items-center mb-3">
                <select class="form-select w-auto ms-auto filter-dropdown" [(ngModel)]="filterType"
                    (change)="applyFilterAndUpdate()">
                    <option value="day">Today</option>
                    <option value="week">This Week</option>
                    <option value="month">This Month</option>
                    <option value="all">All</option>
                </select>
            </div>

            <div *ngIf="checkinVisible">
                <div id="employeeChart" style="width:100%; height:400px;"></div>
            </div>
        </div>
            </mat-card>
        </div>
    </div>
</div>